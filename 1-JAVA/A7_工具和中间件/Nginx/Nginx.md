#### 单机tomcat

优点：开发简单，部署简单

缺点：

* 单点故障 出错不可访问
* 容量 200-300 优化-->500

> 并发的请求，同时发来的请求

#### 多Tomcat DNS轮询架构

优点：

* 单点故障排除
* 容量提升

缺点：应用服务器 全部暴露在外网 入口不集中 不安全 

#### 负载均衡架构

请求分发/负载均衡(不要把鸡蛋放在一个篮子里)

负载均衡典型算法：轮询，随机

缺点：单点故障 一旦故障 所有东西不可用

#### 双击热备负载均衡

请求分发/负载均衡 N --- 存活检测(同一时刻 只有一个在服务)

解决负载均衡单点问题

缺点：

* 利用率低  
* 请求分发设备 也有流量并发上限

#### 双机热备+DNS轮询 ----- 高可用

keepalived : 可以完成某一个节点的存活检测  虚拟IP

_______________________

### 负载均衡

硬件：F5 非常快 可靠性高 并发量大/ 成本太高 不方便

软件实现：

* linux的LVS 基于liunx系统IP层面的负载均衡 可靠性非常高 简单易用 并发量大(不能动静分离)

* apache http server（动静分离）和Nginx比较起来 效率一般般
* **Nginx**（动静分离）

______________

## Nginx

* 负载均衡

* 反向代理（服务器藏起来了）/正向代理（用户藏起来了）

### 压力测试

软件：load runner//**jemeter**

### 负载均衡

* **轮询** (RoundRobin)（default）
  * 问题：session变化
  * 解决：
    1. 应用服务器 session同步 
       * 缺点：应用服务器本身能力有限，再加session同步 带来网络开销 这种方式基本不用
    2. nginx负载均衡算法 设置为 ip hash 请求定位到同一台服务器 不进行切换
       * 解决了session问题，但是不容载了，某些场景可以接受
    3. **session外置** 彻底解决问题 强烈推荐
* 随机(Random)
* **源地址哈希**（Hash）:每次请求IP不变，则发送到同一tomcat
* 加权轮询（WeightRoundRobin）:权重越大，重复添加次数多
* 加权随机（Weight Random）
* 最小连接数（Least Connections）:据后端服务器当前的连接情况，动态地选取其中当前积压连接数最少的一台服务器来处理当前请求

### 动静分离

----

SOA:面向服务架构

系统瓶颈

1. 优先考虑tomcat

2. 数据库 读写分离 拆库拆表 解决数据库 解决应用问题



