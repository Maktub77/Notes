### IoC(控制反转)

* 控制反转`Inversion of Control` ，控制权从应用程序转移到框架（如IoC容器），是框架共有的特性。

* IoC(控制反转)容器：容器主动控制

  ```java
  //返回装配好的a
  A a = ApplicationContext.getBean("a");
  ```

  ```xml
  <!-- 配置文件 -->
  <bean id="a" class="AImpl">
  	<property name="b" ref="b"/>
  </bean>
  <bean id="b" class="BImpl"></bean>
  ```

* 本质：创建对象和装配对象、管理对象生命周期

  * 被动实例化，被动接受依赖，被动装配
  * （工厂+反射+xml）
  * 通用

  > IoC容器：实现了IoC思想的容器就是IoC容器

* IoC容器的特点：

  * 无需主动new对象；而是描述对象应该如何被创建即可
    * IoC容器会帮你创建，即被动实例化
  * 不需要主动装配对象之间的依赖关系，而是描述需要哪个服务（组件）
    * IoC容器会帮你装配（即负责将他们关联起来），被动接受装配；
  * 主动变被动，好莱坞法则
  * 迪米特法则（最少知识原则）：不知道依赖的具体实现，只知道需要提供某类服务的对象（面向抽象编程），松散耦合，一个对象应当对其他对象有尽可能少的了解，不和陌生人（实现）说话
  * IoC是一种让服务消费者不直接依赖于服务提供者的组件设计方式，是一种减少类与类之间依赖的设计原则

* 理解IoC容器问题关键：控制的那些方面被反转了？

  * 谁控制谁？为什么叫反转？
    * IoC容器控制，而以前是应用程序控制，所以叫反转
  * 控制什么？
    * 控制应用程序所需要的资源（对象、文件...）
  * 为什么控制？
    * 解耦组件之间的关系
  * 控制的那些方面被反转了？
    * 程序的控制权发生了反转：从应用程序转移到了IoC容器

  > 容器：提供组件运行环境，管理组件声明周期（不管组件如何创建的以及组件之间关系如何装配的）
  >
  > IoC容器不仅仅具有容器的功能，而且还具有一些其他特性---如依赖装配

### DI(依赖注入)

* 依赖注入`Dependendy Injection `，用一个单独的对象（装配器）来装配对象之间的依赖关系

* 理解DI问题的关键
  * 谁依赖于谁？
    * 应用程序依赖于IoC容器
  * 为什么需要依赖？
    * 应用程序依赖于IoC容器装配类之间的关系
  * 依赖什么东西？
    * 依赖了IoC容器的装配功能
  * 谁注入谁？
    * IoC容器注入应用程序
  * 注入什么东西？
    * 注入应用程序需要的资源（类之间的关系）
  * IoC容器应该具有依赖注入功能，因此也叫DI容器

* DI优点：
  * 帮你看清组件之间的依赖关系，只需观察依赖注入的机制（setter/构造器），就可以掌握整个依赖（类与类之间的关系）

  * 组件之间的依赖关系有容器在运行期决定，形象的来说，即由容器动态的将某种依赖关系注入到组件之中

  * 依赖注入的目标并非为软件系统带来更多的功能，而是为了提升组件重用的概率，并为系统搭建一个灵活、可拓展的平台。通过依赖注入机制，我们只需要通过简单的配置，而无需任何代码就可指定目标需要的资源，完成自身的业务逻辑，而不用关心具体资源来自何处，由谁实现。

  * 使用DI限制：

    组件和装配器（IoC容器）之间不会有依赖关系，因此组件无法从装配器哪里获得更多服务，只能获得配置信息中所提供的那些

* 实现方式

  * 构造器注入
  * setter注入
  * 接口注入：在接口中定义需要注入的信息，并通过接口完成注入

### 小结

* 使用IoC/DI容器开发需要改变的思路
  1. 应用程序不主动创建对象，但要描述创建他们的方式
  2. 在应用程序代码中不直接进行服务的装配，但要配置文件中描述哪一个组件需要哪一项服务。容器负责将这些装配在一起。
* 原理：基于OO设计原则的The Hollywood Principle：don't call us,we will call you.也就是说，所有的组件都是被动的（Passive），所有的组件初始化和装配都由容器负责。组件处在一个容器当中，由容器负责管理。
* IoC容器功能：
  * 实例化、初始化组件、装配组件依赖关系、负责组件生命周期管理。
* 本质：
  * IoC：控制权转移，由应用程序转移到框架；
  * IoC/DI容器：由应用程序主动实例化对象变被动等待对象（被动实例化）；
  * DI：由专门的装配器装配组件之间的关系
  * IoC/DI：由应用程序主动装配对象依赖变应用程序被动接受依赖